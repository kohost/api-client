/* @ts-nocheck */
/* This file is automatically generated. Do not modify it manually. */

import { Entity } from "./entity";
import { validateAutomation as validate } from "../validate";

/**
 * @typedef {Object} AutomationData An automation is a collection of triggers and actions
 * @property {string} id - Identifier of the object.
 * @property {string} [name] - The friendly name of the automation
 * @property {"automation"} type - Default: "automation"
 * @property {boolean} [isEnabled] - Whether the automation is currently enabled. Default: true
 * @property {{discriminator: ("time"|"event"), schedule: {days: number[], time: string, timeOffsetSeconds?: number, repeat?: boolean, timezone: string}}} trigger - The trigger that initiates the automation
 * @property {("time"|"event")} trigger.discriminator - Type of trigger
 * @property {{days: number[], time: string, timeOffsetSeconds?: number, repeat?: boolean, timezone: string}} trigger.schedule - Schedule for time-based triggers
 * @property {number[]} trigger.schedule.days - Days of the week (0 = Sunday, 6 = Saturday)
 * @property {string} trigger.schedule.time - Time of day to trigger the automation
 * @property {number} [trigger.schedule.timeOffsetSeconds] - Offset in seconds from the scheduled time. Default: 0
 * @property {boolean} [trigger.schedule.repeat] - Whether the schedule repeats. Default: true
 * @property {string} trigger.schedule.timezone - Timezone for the schedule (IANA timezone format)
 * @property {{entityId?: string, entityType?: "switch", deviceId: string, roomId: string, discriminator: string, duration?: number, state: {property: string, value: (string|number|boolean)}[]}[]} actions - Actions to perform when the trigger conditions are met
 * @property {(string|object)} [createdAt]
 * @property {(string|object)} [updatedAt]
 * @property {(string|object)} [lastTriggeredAt] - When the automation was last triggered
 */

/**
 * An automation is a collection of triggers and actions
 * @class Automation
 * @extends {Entity}
 */
export class Automation extends Entity {
  /**
   * @constructor
   * @param {AutomationData} data - The data to initialize the Automation with
   */
  constructor(data) {
    super(data);
    this.id = data.id;
    if (data.name !== undefined) this.name = data.name;
    this.type = data.type;
    if (data.isEnabled !== undefined) this.isEnabled = data.isEnabled;
    this.trigger = data.trigger;
    this.actions = data.actions;
    if (data.createdAt !== undefined) this.createdAt = data.createdAt;
    if (data.updatedAt !== undefined) this.updatedAt = data.updatedAt;
    if (data.lastTriggeredAt !== undefined)
      this.lastTriggeredAt = data.lastTriggeredAt;
  }
}

Object.defineProperty(Automation.prototype, "schema", {
  value: {
    $schema: "http://json-schema.org/draft-07/schema",
    $id: "automation.json",
    title: "Automation",
    description: "An automation is a collection of triggers and actions",
    type: "object",
    required: ["id", "type", "trigger", "actions"],
    properties: {
      id: { $ref: "definitions.json#/definitions/id" },
      name: {
        type: "string",
        description: "The friendly name of the automation",
      },
      type: { type: "string", enum: ["automation"], default: "automation" },
      isEnabled: {
        type: "boolean",
        description: "Whether the automation is currently enabled",
        default: true,
      },
      trigger: {
        type: "object",
        description: "The trigger that initiates the automation",
        required: ["discriminator", "schedule"],
        properties: {
          discriminator: {
            type: "string",
            enum: ["time", "event"],
            description: "Type of trigger",
          },
          schedule: {
            type: "object",
            description: "Schedule for time-based triggers",
            required: ["days", "time", "timezone"],
            properties: {
              days: {
                type: "array",
                description: "Days of the week (0 = Sunday, 6 = Saturday)",
                items: { type: "integer", minimum: 0, maximum: 6 },
              },
              time: {
                type: "string",
                description: "Time of day to trigger the automation",
              },
              timeOffsetSeconds: {
                type: "integer",
                description: "Offset in seconds from the scheduled time",
                default: 0,
              },
              repeat: {
                type: "boolean",
                description: "Whether the schedule repeats",
                default: true,
              },
              timezone: {
                type: "string",
                description: "Timezone for the schedule (IANA timezone format)",
              },
            },
          },
        },
      },
      actions: {
        type: "array",
        description: "Actions to perform when the trigger conditions are met",
        items: {
          type: "object",
          required: ["deviceId", "roomId", "discriminator", "state"],
          properties: {
            entityId: {
              type: "string",
              description: "ID of the entity to control",
            },
            entityType: {
              type: "string",
              description: "Type of entity to control",
              enum: ["switch"],
            },
            deviceId: {
              type: "string",
              description: "ID of the device to control",
            },
            roomId: {
              type: "string",
              description: "ID of the room containing the device",
            },
            discriminator: {
              type: "string",
              description:
                "Type discriminator for the device (e.g., 'windowCovering', 'switch')",
            },
            duration: {
              type: "integer",
              description:
                "Duration in seconds to keep the device in the configured state",
              minimum: 0,
            },
            state: {
              type: "array",
              items: {
                type: "object",
                required: ["property", "value"],
                properties: {
                  property: {
                    type: "string",
                    description:
                      "Property to set (e.g., 'state', 'level', 'setpoint')",
                  },
                  value: {
                    type: ["string", "number", "boolean"],
                    description: "Value to set the property to",
                  },
                },
              },
            },
          },
        },
        minItems: 1,
      },
      createdAt: { $ref: "definitions.json#/definitions/createdAt" },
      updatedAt: { $ref: "definitions.json#/definitions/updatedAt" },
      lastTriggeredAt: {
        $ref: "definitions.json#/definitions/date",
        description: "When the automation was last triggered",
      },
    },
    additionalProperties: false,
  },
});

Object.defineProperty(Automation.prototype, "validator", {
  get: function () {
    return validate;
  },
});
